<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="/assets/icon/Pinguim_do_ep.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Iluminart | Usuario </title>

    <script src="../js/sessao.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body onload="obterDados()" >

</body>
</html>

<script>
    
    var graficoLinha

    function obterDados() {

        fetch("/dashboard/luxBuscar")
            .then(function(r) { return r.json(); })
            .then(function(dados) {
                if(dados.length > 0){
                    plotarGraficoLuminosidade(dados);
                    AtualizarKpiLuminosidade(dados);
                }
            });

        fetch("/dashboard/temperaturaBuscar")
            .then(function(r) { return r.json(); })
            .then(function(dados) {
                if(dados.length > 0){
                    plotarGraficoTemperatura(dados);
                    AtualizarKpiTemp(dados);
                }
            });

        fetch("/dashboard/umidadeBuscar")
            .then(function(r) { return r.json(); })
            .then(function(dados) {
                if(dados.length > 0){
                    plotarGraficoUmidade(dados);
                    AtualizarKpiUmidade(dados);
                }
            });
    }
    
    
    function plotarGraficoTemperatura() {
        fetch("/dashboard/temperaturaBuscar")
            .then(function(r) { return r.json(); })
            .then(function(dados) {
                var labels = [];
                var valores = [];
                
                for (var i = 0; i < dados.length; i++) {
                    labels.push("");
                    valores.push(Number(dados[i].temperatura));
                }

                var ctx = document.getElementById('linha').getContext('2d');

             // if da temperatura
            if(dados < 18){
                alert(`A temperatura está abaixo do ideal`)
            } else if(dados > 22){
                alert(`A temperatura está acima do ideal`)
            }else {
                alert(`Temperatura ideal`)
            }


                graficoLinha = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Acertos por tentativa",
                            data: valores,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10
                            }
                        }
                    }
                });
            });

    }

    // Funções KPI e gráficos de barras (mantém iguais)
     function plotarGraficoLuminosidade() {
        fetch("/dashboard/luxBuscar")
            .then(function(r) { return r.json(); })
            .then(function(dados) {
                var labels = [];
                var valores = [];
                
                for (var i = 0; i < dados.length; i++) {
                    labels.push("");
                    valores.push(Number(dados[i].luminosidade));
                }

                var ctx = document.getElementById('linha').getContext('2d');

            // if do lux
            if(dados > 0 && dados <= 50){
                alert(`Porcentagem de risco de luminosidade = 25%`)
            } else if(dados <= 100){
                alert(`Porcentagem de risco de luminosidade = 50%`)
            }else if(dados <= 150){
                alert(`Porcentagem de risco de luminosidade = 75%`)
            }else if(dados <= 200){
                alert(`Porcentagem de risco de luminosidade = 100%`)
            }else{
                alert(`Sua pintura está em risco por conta da luminosidade`)
            }

                graficoLinha = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Acertos por tentativa",
                            data: valores,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10
                            }
                        }
                    }
                });
            });

    }
    

   function plotarGraficoUmidade() {
        fetch("/dashboard/umidadeBuscar")
            .then(function(r) { return r.json(); })
            .then(function(dados) {
                var labels = [];
                var valores = [];
                
                for (var i = 0; i < dados.length; i++) {
                    labels.push("");
                    valores.push(Number(dados[i].umidade));
                }

                var ctx = document.getElementById('linha').getContext('2d');

             // if da temperatura
            if(dados < 18){
                alert(`A temperatura está abaixo do ideal`)
            } else if(dados > 22){
                alert(`A temperatura está acima do ideal`)
            }else {
                alert(`Temperatura ideal`)
            }


                graficoLinha = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Acertos por tentativa",
                            data: valores,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10
                            }
                        }
                    }
                });
            });

    }

    function AtualizarKpiLuminosidade(dados){
        
        document.getElementById('KPI_Luminosidade').innerHTML;
    }

    function AtualizarKpiPersonagem(dados){
        var div = document.getElementById('top1Personagem');
        var personagem = dados[0].personagem;
        div.innerHTML = "";

        var img = "";
        if(personagem == "Gon_Freecss") img = "assets/imgs/Gon.jpg";
        else if(personagem == "Killua_Zoldyck") img = "assets/imgs/Killua.jpg";
        else if(personagem == "Leorio") img = "assets/imgs/Leorio.jpg";
        else if(personagem == "Kurapika") img = "assets/imgs/Kurapika.jfif";

        div.innerHTML = '<img src="' + img + '" width="200">';
    }

    function AtualizarKpiClasse(dados){
        var div = document.getElementById('top1Classe');
        div.innerHTML = "<h2>" + dados[0].classe + "</h2>";
    }
</script>


